<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Riesgo Crediticio - Advanced</title>
    <!-- D3.js -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <!-- D3 Sankey Plugin -->
    <script src="https://unpkg.com/d3-sankey@0.12.3/dist/d3-sankey.min.js"></script>

    <link rel="stylesheet" href="style.css">
</head>

<body>

    <h1>Dashboard de Riesgo Crediticio</h1>

    <div class="dashboard-grid">
        <!-- KPI Cards -->
        <div class="kpi-container">
            <div class="kpi-card">
                <div class="kpi-label">Total Clientes</div>
                <div class="kpi-value" id="kpi-total">-</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">Tasa Aprobación</div>
                <div class="kpi-value" id="kpi-approval">-</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">Score Promedio</div>
                <div class="kpi-value" id="kpi-score">-</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">Ratio Deuda/Solicitado</div>
                <div class="kpi-value" id="kpi-debt">-</div>
            </div>
        </div>

        <!-- Global Legend -->
        <div class="legend-container"
            style="grid-column: 1 / -1; display: flex; justify-content: center; gap: 20px; margin-bottom: 10px;">
            <div style="display: flex; align-items: center; gap: 5px;">
                <div style="width: 15px; height: 15px; background-color: #4682b4; border-radius: 3px;"></div>
                <span>Aprobado</span>
            </div>
            <div style="display: flex; align-items: center; gap: 5px;">
                <div style="width: 15px; height: 15px; background-color: #cd5c5c; border-radius: 3px;"></div>
                <span>Rechazado</span>
            </div>
            <div style="display: flex; align-items: center; gap: 5px;">
                <div style="width: 15px; height: 15px; background-color: #95a5a6; border-radius: 3px;"></div>
                <span>Otros/Neutral</span>
            </div>
        </div>

        <!-- Row 1: Sankey Diagram (Flow) -->
        <div class="chart-container sankey-section">
            <div class="chart-header">
                <h2 class="chart-title">Flujo de Segmentación (Nacionalidad → Contrato → Decisión)</h2>
            </div>
            <div id="sankey-chart" style="width: 100%; height: 100%;"></div>
        </div>

        <!-- Row 2: Analytical Charts (New) -->
        <div class="chart-container" style="grid-column: span 2;">
            <div class="chart-header">
                <h2 class="chart-title">Análisis por Comuna: Ingreso vs Rechazo</h2>
            </div>
            <div id="commune-chart" style="width: 100%; height: 300px;"></div>
        </div>

        <div class="chart-container" style="grid-column: span 2;">
            <div class="chart-header">
                <h2 class="chart-title">Score por Nacionalidad</h2>
            </div>
            <div id="nationality-chart" style="width: 100%; height: 300px;"></div>
        </div>

        <div class="chart-container" style="grid-column: 1 / -1;">
            <div class="chart-header">
                <h2 class="chart-title">Tasa de Rechazo por Edad</h2>
            </div>
            <div id="age-chart" style="width: 100%; height: 250px;"></div>
        </div>

        <!-- Row 3: Details/Scatter -->
        <div class="chart-container details-section">
            <div class="chart-header">
                <h2 class="chart-title">Detalle de Clientes (Top 50 Filtrados)</h2>
            </div>
            <div class="data-table-wrapper">
                <table id="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Edad</th>
                            <th>Nacionalidad</th>
                            <th>Ingresos</th>
                            <th>Score</th>
                            <th>Decisión</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- Row 4: Linked Histograms -->
        <div class="histograms-section">
            <div class="histogram-container" id="hist-score"></div>
            <div class="histogram-container" id="hist-income"></div>
            <div class="histogram-container" id="hist-debt"></div>
        </div>
    </div>

    <div id="tooltip" class="tooltip"></div>

    <script src="script.js"></script>
</body>

</html>